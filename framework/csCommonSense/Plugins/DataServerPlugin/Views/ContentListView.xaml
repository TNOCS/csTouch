<UserControl x:Class="csDataServerPlugin.ContentListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:Custom="http://schemas.microsoft.com/surface/2008"
             xmlns:SlideTab="clr-namespace:csShared.Controls.SlideTab"
             xmlns:cal="http://www.caliburnproject.org"
             xmlns:controls="clr-namespace:csShared.Controls"
             xmlns:csDataServerPlugin="clr-namespace:csDataServerPlugin"
             xmlns:csGeoLayers="clr-namespace:csGeoLayers"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:dataServer="clr-namespace:DataServer"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:ratingControl="clr-namespace:csDataServerPlugin.RatingControl"
             xmlns:viewModels="clr-namespace:csDataServerPlugin.ViewModels"
             xmlns:wpfConverters="clr-namespace:WpfConverters"
             x:Name="userControl"
             mc:Ignorable="d">
    <UserControl.Resources>
        <wpfConverters:BooleanActiveOpacityConverter x:Key="BooleanActiveOpacityConverter1" />
        <csDataServerPlugin:ReverseBooleanVisiblityConverter x:Key="ReverseBooleanVisiblityConverter" />
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <csDataServerPlugin:PoiCallOutViewConverter x:Key="PoiCallOutViewConverter" />
        <Style x:Key="ControlBaseStyle" TargetType="{x:Type Control}">
            <Setter Property="FocusVisualStyle" Value="{x:Null}" />
            <Setter Property="SnapsToDevicePixels" Value="False" />
            <Setter Property="FontFamily" Value="Segoe360" />
            <Setter Property="FontWeight" Value="Normal" />
            <Setter Property="FontSize" Value="17" />
            <Setter Property="Padding" Value="6,2,10,10" />
            <Setter Property="MinHeight" Value="38" />
            <Setter Property="MinWidth" Value="38" />
            <Setter Property="Margin" Value="1" />
            <Setter Property="HorizontalContentAlignment" Value="Left" />
            <Setter Property="VerticalContentAlignment" Value="Top" />
            <Setter Property="BorderThickness" Value="2" />
        </Style>
        <Style x:Key="ButtonStyle"
               BasedOn="{StaticResource ControlBaseStyle}"
               TargetType="{x:Type Custom:SurfaceButton}">
            <Setter Property="IsTabStop" Value="False" />
            <Setter Property="Focusable" Value="True" />
            <Setter Property="Background" Value="{DynamicResource {x:Static Custom:SurfaceColors.ButtonBackgroundBrushKey}}" />
            <Setter Property="Foreground" Value="{DynamicResource {x:Static Custom:SurfaceColors.ButtonForegroundBrushKey}}" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Custom:SurfaceButton}">
                        <ControlTemplate.Resources>
                            <Storyboard x:Key="Press">
                                <DoubleAnimationUsingKeyFrames BeginTime="00:00:00"
                                                               Storyboard.TargetName="PressOverlay"
                                                               Storyboard.TargetProperty="(UIElement.Opacity)">
                                    <SplineDoubleKeyFrame KeyTime="00:00:00.1000000" Value="1" />
                                </DoubleAnimationUsingKeyFrames>
                            </Storyboard>
                            <Storyboard x:Key="Release">
                                <DoubleAnimationUsingKeyFrames BeginTime="00:00:00"
                                                               Storyboard.TargetName="PressOverlay"
                                                               Storyboard.TargetProperty="(UIElement.Opacity)">
                                    <SplineDoubleKeyFrame KeyTime="00:00:00.1500000" Value="0" />
                                </DoubleAnimationUsingKeyFrames>
                            </Storyboard>
                        </ControlTemplate.Resources>
                        <Grid x:Name="Grid" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}">
                            <Rectangle x:Name="ButtonBody"
                                       Fill="#4D000000"
                                       SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                            <Rectangle x:Name="PressOverlay"
                                       Fill="{DynamicResource {x:Static Custom:SurfaceColors.ButtonBackgroundPressedBrushKey}}"
                                       Opacity="0"
                                       SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                            <ContentPresenter x:Name="Content"
                                              Margin="{TemplateBinding Padding}"
                                              HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                              SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                        </Grid>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsPressed" Value="True">
                                <Trigger.EnterActions>
                                    <BeginStoryboard Storyboard="{StaticResource Press}" />
                                </Trigger.EnterActions>
                                <Trigger.ExitActions>
                                    <BeginStoryboard Storyboard="{StaticResource Release}" />
                                </Trigger.ExitActions>
                                <Setter Property="Foreground" Value="{DynamicResource {x:Static Custom:SurfaceColors.ButtonForegroundPressedBrushKey}}" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="ButtonBody" Property="Fill" Value="{DynamicResource {x:Static Custom:SurfaceColors.ButtonBackgroundDisabledBrushKey}}" />
                                <Setter Property="Foreground" Value="{DynamicResource {x:Static Custom:SurfaceColors.ButtonForegroundDisabledBrushKey}}" />
                                <Setter TargetName="Content" Property="Opacity" Value="0.33" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <wpfConverters:BooleanActiveOpacityConverter x:Key="BooleanActiveOpacityConverter" />

        <DataTemplate x:Key="ConnectionTemplate">
            <Grid Opacity="{Binding Available, Converter={StaticResource BooleanActiveOpacityConverter}}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="40" />
                    <ColumnDefinition />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBlock VerticalAlignment="Top"
                           FontSize="21.333"
                           Text="✓"
                           TextAlignment="Center"
                           TextWrapping="Wrap"
                           Visibility="{Binding Current,
                                                Converter={StaticResource BooleanToVisibilityConverter}}"
                           d:LayoutOverrides="Width" />
                <StackPanel Grid.Column="1">
                    <TextBlock Margin="0"
                               TextWrapping="Wrap"
                               d:LayoutOverrides="Width">
                        <TextBlock.Text>
                            <MultiBinding StringFormat=" {0} ({1})">
                                <Binding Path="Server" />
                                <Binding Path="Port" />
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </StackPanel>
                <StackPanel Grid.Column="2"
                            Orientation="Horizontal"
                            d:LayoutOverrides="Height">
                    <Custom:SurfaceButton x:Name="Remove"
                                          Width="50"
                                          Margin="0"
                                          HorizontalAlignment="Right"
                                          VerticalAlignment="Stretch"
                                          HorizontalContentAlignment="Center"
                                          VerticalContentAlignment="Center"
                                          IsEnabled="{Binding CanDelete}"
                                          Padding="4,2"
                                          Style="{DynamicResource ButtonStyle}"
                                          cal:Message.Attach="Remove($dataContext)">
                        <Image Width="Auto"
                               Height="Auto"
                               Source="/csCommon;component/Resources/Icons/appbar.delete.png" />
                    </Custom:SurfaceButton>
                    <Custom:SurfaceButton x:Name="Connect"
                                          Width="50"
                                          Margin="10,0,0,0"
                                          HorizontalAlignment="Right"
                                          VerticalAlignment="Stretch"
                                          HorizontalContentAlignment="Center"
                                          VerticalContentAlignment="Center"
                                          IsEnabled="{Binding Available}"
                                          Padding="4,2"
                                          Style="{DynamicResource ButtonStyle}"
                                          cal:Message.Attach="Connect($dataContext)">
                        <Image Width="25"
                               Height="Auto"
                               Margin="0"
                               Source="/csCommon;component/Resources/Icons/link.png" />
                    </Custom:SurfaceButton>
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="numberTemplate">
            <StackPanel Margin="5,0,5,10">
                <TextBlock HorizontalAlignment="Left"
                           VerticalAlignment="Top"
                           FontSize="12"
                           FontWeight="Bold"
                           Text="{Binding Meta.Title}"
                           TextWrapping="Wrap" />
                <Slider Margin="3,0,5,0"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Top"
                        Maximum="100"
                        Minimum="0"
                        Value="{Binding Data,
                                        Mode=TwoWay,
                                        NotifyOnSourceUpdated=True,
                                        UpdateSourceTrigger=PropertyChanged}" />
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="textTemplate">
            <StackPanel Margin="5,0,5,10" Background="{x:Null}">
                <TextBlock HorizontalAlignment="Left"
                           VerticalAlignment="Top"
                           FontSize="12"
                           FontWeight="Bold"
                           Text="{Binding Meta.Title}"
                           TextWrapping="Wrap" />
                <TextBox Margin="3,0,5,0"
                         HorizontalAlignment="Stretch"
                         VerticalAlignment="Top"
                         FontSize="16"
                         Text="{Binding Data,
                                        Mode=TwoWay,
                                        NotifyOnSourceUpdated=True,
                                        UpdateSourceTrigger=PropertyChanged}"
                         TextWrapping="Wrap" />
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="RatingTemplate">
            <StackPanel Margin="0,0,10,0"
                        Background="{x:Null}"
                        Orientation="Horizontal">
                <ratingControl:RatingControl Width="90"
                                             Margin="3,0,5,0"
                                             HorizontalAlignment="Stretch"
                                             VerticalAlignment="Center"
                                             HorizontalContentAlignment="Left"
                                             FontSize="16"
                                             RatingValue="{Binding Data,
                                                                   Converter={wpfConverters:ConvertStringToInt}}" />
                <TextBlock Margin="0,2,0,0"
                           HorizontalAlignment="Left"
                           VerticalAlignment="Top"
                           FontSize="16"
                           Text="{Binding Meta.Title}"
                           TextWrapping="Wrap" />
            </StackPanel>
        </DataTemplate>

        <viewModels:MetaLabelTemplateSelector x:Key="MetaLabelTemplateSelector"
                                              NumberTemplate="{StaticResource numberTemplate}"
                                              RatingTemplate="{StaticResource RatingTemplate}"
                                              TextTemplate="{StaticResource textTemplate}" />

        <Style x:Key="TabItemStyle1" TargetType="{x:Type TabItem}">
            <Setter Property="FocusVisualStyle" Value="{StaticResource TabItemFocusVisual}" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderBrush" Value="{StaticResource TabControlNormalBorderBrush}" />
            <Setter Property="Background" Value="{StaticResource ButtonNormalBackground}" />
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="VerticalContentAlignment" Value="Stretch" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type SlideTab:SlideTabItem}">
                        <Grid x:Name="grid"
                              Margin="0"
                              SnapsToDevicePixels="true">
                            <Border x:Name="Bd"
                                    Height="Auto"
                                    Margin="0,5,0,0"
                                    Background="Transparent"
                                    BorderBrush="Black"
                                    BorderThickness="0,0,0,1">
                                <ContentPresenter ContentSource="Header" />
                            </Border>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="False">
                                <Setter Property="Panel.ZIndex" Value="1" />
                                <Setter TargetName="Bd" Property="Margin" Value="0" />
                            </Trigger>
                            <Trigger Property="Selector.IsSelected" Value="True">
                                <Setter TargetName="Bd" Property="BorderBrush" Value="Black" />
                                <Setter TargetName="Bd" Property="BorderThickness" Value="1,1,1,0" />
                                <Setter TargetName="grid" Property="Margin" Value="0" />
                                <Setter TargetName="Bd" Property="CornerRadius" Value="0" />
                                <Setter TargetName="Bd" Property="Margin" Value="0,5,0,0" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="false">
                                <Setter TargetName="Bd" Property="BorderBrush" Value="{StaticResource TabItemDisabledBorderBrush}" />
                                <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SlideTabControlStyle1" TargetType="{x:Type SlideTab:SlideTabControl}">
            <Setter Property="Padding" Value="2" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="Background" Value="White" />
            <Setter Property="BorderBrush" Value="#FFACACAC" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type SlideTab:SlideTabControl}">
                        <Grid x:Name="templateRoot"
                              ClipToBounds="True"
                              KeyboardNavigation.TabNavigation="Local"
                              SnapsToDevicePixels="True">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition x:Name="ColumnDefinition0" />
                                <ColumnDefinition x:Name="ColumnDefinition1" Width="0" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition x:Name="RowDefinition0" Height="Auto" />
                                <RowDefinition x:Name="RowDefinition1" Height="*" />
                            </Grid.RowDefinitions>
                            <Border Grid.RowSpan="2"
                                    Width="20"
                                    Height="50"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    BorderBrush="Black"
                                    BorderThickness="0,0,0,1" />
                            <Border Grid.Row="0"
                                    Grid.Column="0"
                                    Height="50"
                                    Margin="20,0,0,0"
                                    BorderBrush="Black"
                                    BorderThickness="0">
                                <TabPanel x:Name="HeaderPanel"
                                          Panel.ZIndex="1"
                                          Background="{x:Null}"
                                          IsItemsHost="True"
                                          KeyboardNavigation.TabIndex="1" />
                            </Border>
                            <Border x:Name="ContentPanel"
                                    Grid.Row="1"
                                    Grid.Column="0"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    KeyboardNavigation.DirectionalNavigation="Contained"
                                    KeyboardNavigation.TabIndex="2"
                                    KeyboardNavigation.TabNavigation="Local">
                                <ContentPresenter x:Name="PART_SelectedContentHost"
                                                  Margin="{TemplateBinding Padding}"
                                                  Content="{TemplateBinding SelectedContent}"
                                                  ContentSource="SelectedContent"
                                                  ContentStringFormat="{TemplateBinding SelectedContentStringFormat}"
                                                  ContentTemplate="{TemplateBinding SelectedContentTemplate}"
                                                  SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                            </Border>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="TabStripPlacement" Value="Bottom">
                                <Setter TargetName="HeaderPanel" Property="Grid.Row" Value="1" />
                                <Setter TargetName="ContentPanel" Property="Grid.Row" Value="0" />
                                <Setter TargetName="RowDefinition0" Property="Height" Value="*" />
                                <Setter TargetName="RowDefinition1" Property="Height" Value="Auto" />
                                <Setter TargetName="HeaderPanel" Property="Margin" Value="2,0,2,2" />
                            </Trigger>
                            <Trigger Property="TabStripPlacement" Value="Left">
                                <Setter TargetName="HeaderPanel" Property="Grid.Row" Value="0" />
                                <Setter TargetName="ContentPanel" Property="Grid.Row" Value="0" />
                                <Setter TargetName="HeaderPanel" Property="Grid.Column" Value="0" />
                                <Setter TargetName="ContentPanel" Property="Grid.Column" Value="1" />
                                <Setter TargetName="ColumnDefinition0" Property="Width" Value="Auto" />
                                <Setter TargetName="ColumnDefinition1" Property="Width" Value="*" />
                                <Setter TargetName="RowDefinition0" Property="Height" Value="*" />
                                <Setter TargetName="RowDefinition1" Property="Height" Value="0" />
                                <Setter TargetName="HeaderPanel" Property="Margin" Value="2,2,0,2" />
                            </Trigger>
                            <Trigger Property="TabStripPlacement" Value="Right">
                                <Setter TargetName="HeaderPanel" Property="Grid.Row" Value="0" />
                                <Setter TargetName="ContentPanel" Property="Grid.Row" Value="0" />
                                <Setter TargetName="HeaderPanel" Property="Grid.Column" Value="1" />
                                <Setter TargetName="ContentPanel" Property="Grid.Column" Value="0" />
                                <Setter TargetName="ColumnDefinition0" Property="Width" Value="*" />
                                <Setter TargetName="ColumnDefinition1" Property="Width" Value="Auto" />
                                <Setter TargetName="RowDefinition0" Property="Height" Value="*" />
                                <Setter TargetName="RowDefinition1" Property="Height" Value="0" />
                                <Setter TargetName="HeaderPanel" Property="Margin" Value="0,2,2,2" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="templateRoot" Property="TextElement.Foreground" Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <DataTemplate x:Key="EventTemplate">
            <Grid>
                <StackPanel Orientation="Vertical">
                    <TextBlock Margin="0,0,0,-0.001"
                               HorizontalAlignment="Left"
                               VerticalAlignment="Top"
                               FontSize="21.333"
                               Text="{Binding Name}"
                               TextWrapping="Wrap" />
                    <ItemsControl x:Name="icAllMedia"
                                  Width="20"
                                  Height="28.373"
                                  HorizontalAlignment="Left"
                                  VerticalAlignment="Top"
                                  ItemTemplate="{DynamicResource MediaTemplate}"
                                  ItemsSource="{Binding AllMedia}" />
                </StackPanel>
            </Grid>
        </DataTemplate>
        <DataTemplate x:Key="TaskTemplate">
            <Grid>
                <Grid Width="Auto"
                      Height="Auto"
                      Background="{x:Null}">
                    <Grid>
                        <StackPanel Grid.Row="0"
                                    Margin="0"
                                    Orientation="Vertical">
                            <Grid>
                                <TextBlock Margin="5,0,0,0"
                                           FontSize="21"
                                           FontWeight="Bold"
                                           Text="{Binding Name}" />
                                <StackPanel Margin="2,0,0,0"
                                            HorizontalAlignment="Right"
                                            Orientation="Horizontal">
                                    <Custom:SurfaceToggleButton x:Name="stbExpand"
                                                                MinWidth="20"
                                                                MinHeight="20"
                                                                Margin="0"
                                                                HorizontalAlignment="Left"
                                                                VerticalAlignment="Top"
                                                                IsChecked="True"
                                                                Style="{DynamicResource SurfaceToggleButtonStyle1}">
                                        <Custom:SurfaceToggleButton.Resources>
                                            <!--  ToggleButton  -->
                                            <Style x:Key="SurfaceToggleButtonStyle1"
                                                   BasedOn="{StaticResource ControlBaseStyle}"
                                                   TargetType="{x:Type Custom:SurfaceToggleButton}">
                                                <Setter Property="HorizontalContentAlignment" Value="Center" />
                                                <Setter Property="VerticalContentAlignment" Value="Center" />
                                                <Setter Property="Padding" Value="7" />
                                                <Setter Property="Background" Value="{DynamicResource {x:Static Custom:SurfaceColors.ButtonBackgroundBrushKey}}" />
                                                <Setter Property="Foreground" Value="{DynamicResource {x:Static Custom:SurfaceColors.ButtonForegroundBrushKey}}" />
                                                <Setter Property="BorderThickness" Value="0" />
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="{x:Type Custom:SurfaceToggleButton}">
                                                            <ControlTemplate.Resources>
                                                                <Storyboard x:Key="Press">
                                                                    <DoubleAnimationUsingKeyFrames BeginTime="00:00:00"
                                                                                                   Storyboard.TargetName="PressOverlay"
                                                                                                   Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                        <SplineDoubleKeyFrame KeyTime="00:00:00.1000000" Value="1" />
                                                                    </DoubleAnimationUsingKeyFrames>
                                                                </Storyboard>
                                                                <Storyboard x:Key="Release">
                                                                    <DoubleAnimationUsingKeyFrames BeginTime="00:00:00"
                                                                                                   Storyboard.TargetName="PressOverlay"
                                                                                                   Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                        <SplineDoubleKeyFrame KeyTime="00:00:00.2500000" Value="0" />
                                                                    </DoubleAnimationUsingKeyFrames>
                                                                </Storyboard>
                                                            </ControlTemplate.Resources>
                                                            <Grid x:Name="Grid" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}">
                                                                <Border x:Name="ButtonBody"
                                                                        Background="{TemplateBinding Background}"
                                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                                        SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                                                <Border x:Name="PressOverlay"
                                                                        Background="{DynamicResource {x:Static Custom:SurfaceColors.ButtonBackgroundPressedBrushKey}}"
                                                                        Opacity="0"
                                                                        SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                                                <ContentPresenter x:Name="Content"
                                                                                  HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                                                  VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                                                  SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                                            </Grid>

                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsChecked" Value="True">
                                                                    <Setter TargetName="ButtonBody" Property="Background" Value="{DynamicResource {x:Static Custom:SurfaceColors.ToggleButtonBackgroundCheckedBrushKey}}" />
                                                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static Custom:SurfaceColors.ButtonForegroundBrushKey}}" />
                                                                </Trigger>
                                                                <Trigger Property="IsPressed" Value="True">
                                                                    <Trigger.EnterActions>
                                                                        <BeginStoryboard Storyboard="{StaticResource Press}" />
                                                                    </Trigger.EnterActions>
                                                                    <Trigger.ExitActions>
                                                                        <BeginStoryboard Storyboard="{StaticResource Release}" />
                                                                    </Trigger.ExitActions>
                                                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static Custom:SurfaceColors.ButtonForegroundPressedBrushKey}}" />
                                                                </Trigger>
                                                                <MultiTrigger>
                                                                    <MultiTrigger.Conditions>
                                                                        <Condition Property="IsPressed" Value="True" />
                                                                        <Condition Property="IsChecked" Value="True" />
                                                                    </MultiTrigger.Conditions>
                                                                    <Setter TargetName="PressOverlay" Property="Background" Value="{DynamicResource {x:Static Custom:SurfaceColors.ToggleButtonBackgroundCheckedPressedBrushKey}}" />
                                                                </MultiTrigger>
                                                                <MultiTrigger>
                                                                    <MultiTrigger.Conditions>
                                                                        <Condition Property="IsEnabled" Value="False" />
                                                                        <Condition Property="IsChecked" Value="True" />
                                                                    </MultiTrigger.Conditions>
                                                                    <Setter TargetName="ButtonBody" Property="Background" Value="{DynamicResource {x:Static Custom:SurfaceColors.ToggleButtonBackgroundCheckedDisabledBrushKey}}" />
                                                                    <Setter TargetName="Content" Property="Opacity" Value="0.6" />
                                                                </MultiTrigger>
                                                                <MultiTrigger>
                                                                    <MultiTrigger.Conditions>
                                                                        <Condition Property="IsEnabled" Value="False" />
                                                                        <Condition Property="IsChecked" Value="False" />
                                                                    </MultiTrigger.Conditions>
                                                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static Custom:SurfaceColors.ButtonForegroundDisabledBrushKey}}" />
                                                                    <Setter TargetName="ButtonBody" Property="Background" Value="{DynamicResource {x:Static Custom:SurfaceColors.ButtonBackgroundDisabledBrushKey}}" />
                                                                    <Setter TargetName="Content" Property="Opacity" Value="0.33" />
                                                                </MultiTrigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </Custom:SurfaceToggleButton.Resources>
                                        <Path Width="15"
                                              Height="15"
                                              Margin="0,0,0,0"
                                              Data="M30.707001,52.895L63.441002,52.895 63.441002,58.181999 30.707001,58.181999z M0,47.075001L16.922001,47.075001 16.922001,64 0,64z M30.707001,29.372L63.441002,29.372 63.441002,34.66 30.707001,34.66z M0,23.555L16.922001,23.555 16.922001,40.478001 0,40.478001z M30.707001,5.8150005L63.441002,5.8150005 63.441002,11.103 30.707001,11.103z M0,0L16.922001,0 16.922001,16.921 0,16.921z"
                                              Fill="#FF898989"
                                              RenderTransformOrigin="0.5,0.5"
                                              Stretch="Uniform">
                                            <Path.RenderTransform>
                                                <TransformGroup>
                                                    <RotateTransform Angle="0" />
                                                    <ScaleTransform ScaleX="1" ScaleY="1" />
                                                </TransformGroup>
                                            </Path.RenderTransform>
                                        </Path>
                                    </Custom:SurfaceToggleButton>
                                </StackPanel>
                            </Grid>
                            <Grid Margin="0,0,0,0">
                                <Grid.Resources>
                                    <DataTemplate x:Key="HighlightTemplate">
                                        <Grid Background="{x:Null}">
                                            <StackPanel>
                                                <Custom:SurfaceCheckBox x:Name="surfaceCheckBox"
                                                                        MinWidth="0"
                                                                        MinHeight="0"
                                                                        BorderBrush="#99000000"
                                                                        Content="{Binding Title}"
                                                                        FontSize="17"
                                                                        Foreground="Black"
                                                                        IsChecked="{Binding IsActive,
                                                                                            Mode=TwoWay}" />
                                                <StackPanel Orientation="Vertical" Visibility="{Binding IsChecked, Converter={StaticResource BooleanToVisibilityConverter}, ElementName=surfaceCheckBox}">
                                                    <TextBlock HorizontalAlignment="Stretch"
                                                               VerticalAlignment="Stretch"
                                                               FontSize="17"
                                                               Foreground="Black"
                                                               Text="{Binding VisualType}"
                                                               TextWrapping="Wrap" />
                                                </StackPanel>
                                            </StackPanel>
                                        </Grid>
                                    </DataTemplate>
                                </Grid.Resources>
                                <StackPanel Margin="0" Orientation="Vertical">
                                    <Grid Margin="0"
                                          Background="{x:Null}"
                                          Visibility="{Binding IsChecked,
                                                               BindsDirectlyToSource=True,
                                                               Converter={StaticResource BooleanToVisibilityConverter},
                                                               ElementName=stbExpand}">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <ItemsControl Width="Auto"
                                                      Margin="20,0,0,0"
                                                      VerticalAlignment="Stretch"
                                                      ItemTemplate="{StaticResource HighlightTemplate}"
                                                      ItemsSource="{Binding EffectiveStyle.Analysis.Highlights}" />
                                    </Grid>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Grid>
                </Grid>
            </Grid>
        </DataTemplate>
        <SolidColorBrush x:Key="ControlHitAreaBrush" Color="#00FFFFFF" />
        <Style x:Key="SurfaceCheckBoxStyle1"
               BasedOn="{StaticResource ControlBaseStyle}"
               TargetType="{x:Type Custom:SurfaceCheckBox}">
            <Setter Property="Background" Value="{DynamicResource {x:Static Custom:SurfaceColors.ControlBackgroundBrushKey}}" />
            <Setter Property="Foreground" Value="{DynamicResource {x:Static Custom:SurfaceColors.ControlForegroundBrushKey}}" />
            <Setter Property="BorderBrush" Value="{DynamicResource {x:Static Custom:SurfaceColors.ControlBorderBrushKey}}" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Custom:SurfaceCheckBox}">
                        <ControlTemplate.Resources>
                            <Storyboard x:Key="Checked">
                                <DoubleAnimation Duration="00:00:00.0100000"
                                                 Storyboard.TargetName="Checkmark"
                                                 Storyboard.TargetProperty="Opacity"
                                                 To="1" />
                            </Storyboard>
                            <Storyboard x:Key="Unchecked">
                                <DoubleAnimation Duration="00:00:00.1500000"
                                                 From="0.4"
                                                 Storyboard.TargetName="Checkmark"
                                                 Storyboard.TargetProperty="Opacity"
                                                 To="0" />
                            </Storyboard>
                        </ControlTemplate.Resources>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Rectangle x:Name="hitArea"
                                       Grid.ColumnSpan="2"
                                       Width="{TemplateBinding Width}"
                                       Height="{TemplateBinding Height}"
                                       Fill="{StaticResource ControlHitAreaBrush}" />
                            <BulletDecorator x:Name="bulletDecorator"
                                             Grid.Column="0"
                                             VerticalAlignment="{TemplateBinding VerticalContentAlignment}">
                                <BulletDecorator.Bullet>
                                    <Border x:Name="CheckButtonRect"
                                            Width="16"
                                            Height="16"
                                            Margin="1,6,0,0"
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="#99000000"
                                            BorderThickness="{TemplateBinding BorderThickness}">
                                        <Grid>
                                            <Path x:Name="Checkmark"
                                                  Width="10"
                                                  Height="10"
                                                  Data="M0,24 L12,0 M0,0 L12,24"
                                                  Fill="{x:Null}"
                                                  Opacity="0"
                                                  Stretch="Fill"
                                                  Stroke="Black"
                                                  StrokeEndLineCap="Flat"
                                                  StrokeStartLineCap="Flat"
                                                  StrokeThickness="2" />
                                            <Rectangle x:Name="ThreeStateMark"
                                                       Width="6"
                                                       Height="6"
                                                       Fill="{DynamicResource {x:Static Custom:SurfaceColors.BulletBrushKey}}"
                                                       Opacity="0" />
                                        </Grid>
                                    </Border>
                                </BulletDecorator.Bullet>
                            </BulletDecorator>
                            <ContentPresenter x:Name="Content"
                                              Grid.Column="1"
                                              Margin="{TemplateBinding Padding}"
                                              HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                              SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                        </Grid>
                        <ControlTemplate.Triggers>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsThreeState" Value="True" />
                                    <Condition Property="IsChecked" Value="{x:Null}" />
                                </MultiTrigger.Conditions>
                                <Setter TargetName="Checkmark" Property="Opacity" Value="0" />
                                <Setter TargetName="ThreeStateMark" Property="Opacity" Value="1" />
                            </MultiTrigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Trigger.EnterActions>
                                    <BeginStoryboard Storyboard="{StaticResource Checked}" />
                                </Trigger.EnterActions>
                                <Trigger.ExitActions>
                                    <BeginStoryboard Storyboard="{StaticResource Unchecked}" />
                                </Trigger.ExitActions>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="{DynamicResource {x:Static Custom:SurfaceColors.ControlBackgroundPressedBrushKey}}" />
                                <Setter Property="BorderBrush" Value="{DynamicResource {x:Static Custom:SurfaceColors.ControlBorderPressedBrushKey}}" />
                                <Setter Property="Foreground" Value="{DynamicResource {x:Static Custom:SurfaceColors.ControlForegroundPressedBrushKey}}" />
                                <Setter TargetName="Checkmark" Property="Stroke" Value="{DynamicResource {x:Static Custom:SurfaceColors.BulletPressedBrushKey}}" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="BorderBrush" Value="{DynamicResource {x:Static Custom:SurfaceColors.ControlBorderDisabledBrushKey}}" />
                                <Setter Property="Background" Value="{DynamicResource {x:Static Custom:SurfaceColors.ControlBackgroundDisabledBrushKey}}" />
                                <Setter Property="Foreground" Value="{DynamicResource {x:Static Custom:SurfaceColors.ControlForegroundDisabledBrushKey}}" />
                                <Setter TargetName="Checkmark" Property="Stroke" Value="{DynamicResource {x:Static Custom:SurfaceColors.BulletDisabledBrushKey}}" />
                                <Setter TargetName="ThreeStateMark" Property="Fill" Value="{DynamicResource {x:Static Custom:SurfaceColors.BulletDisabledBrushKey}}" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <DataTemplate x:Key="MediaTemplate">
            <Grid>
                <csGeoLayers:ucDocument Document="{Binding Doc}" />

                <!--<Image x:Name="iMain"
               ThirdParty:Loader.DisplayOption="Preview"
               ThirdParty:Loader.CacheHeight="50"
                                   ThirdParty:Loader.Source="{Binding LocalUrl}"
                  ThirdParty:Loader.DisplayWaitingAnimationDuringLoading="True"
               SnapsToDevicePixels="True" Stretch="Fill" d:LayoutOverrides="Width, Height" />-->
                <!--<Image HorizontalAlignment="Left" Height="35" VerticalAlignment="Top" Width="35" Source="{Binding Image}" />-->
            </Grid>
        </DataTemplate>

    </UserControl.Resources>
    <Grid x:Name="grid" Margin="0">
        <Border Height="50"
                Margin="245,0,0,0"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Top"
                BorderBrush="Black"
                BorderThickness="0,0,0,1" />
        <SlideTab:SlideTabControl HorizontalContentAlignment="Stretch"
                                  VerticalContentAlignment="Stretch"
                                  Background="{x:Null}"
                                  BorderThickness="0"
                                  SelectedIndex="{Binding SelectedTab,
                                                          Mode=TwoWay}"
                                  Style="{DynamicResource SlideTabControlStyle1}">
            <SlideTab:SlideTabItem x:Name="stiTimeline"
                                   Height="50"
                                   MinWidth="75"
                                   Background="{x:Null}"
                                   FontSize="16"
                                   Foreground="Black"
                                   Padding="0"
                                   ShowHeaderText="Hidden"
                                   Style="{DynamicResource TabItemStyle1}"
                                   Visibility="Collapsed">
                <!--  Visibility="{Binding ShowTimeline, Converter={StaticResource BooleanToVisibilityConverter}}">  -->
                <SlideTab:SlideTabItem.Header>
                    <Grid Margin="0" Background="Transparent">
                        <Path Width="30"
                              Height="30"
                              Margin="0"
                              Data="M31.591471,12.000261L36.091914,37.153566 16.509991,44.639666 28.091128,33.360605z M30.843447,2.5298505E-07C30.893378,-8.4328349E-08 30.933419,-8.4328349E-08 30.983471,2.5298505E-07 31.033402,-8.4328349E-08 31.093464,-8.4328349E-08 31.143393,2.5298505E-07L31.153403,2.5298505E-07C31.743407,-8.4328349E-08,32.363562,-8.4328349E-08,33.053545,0.10052816L33.063555,0.10052816C33.493513,0.10052795,33.933604,0.10052795,34.353674,0.20008024L34.703673,0.20008024C40.063986,0.79934419,45.184298,2.7981927,49.514521,5.8969946L51.444697,7.2956028 54.044833,3.3984335 55.444941,11.094195 56.554995,17.289846 49.474604,16.890661 42.844187,16.490501 46.634341,12.992517 44.174227,11.393827C41.254004,9.4945307,37.883799,8.1954746,34.433634,7.7953148L31.343479,7.5962105C31.263396,7.5962105 31.183434,7.5962105 31.093464,7.5962105 24.713065,7.6957626 18.732714,10.194324 14.272356,14.791285 9.8021101,19.389223 7.3719057,25.385769 7.4419793,31.781498 7.5719913,44.774015 18.282614,55.368498 31.333468,55.368498 31.41343,55.368498 31.493389,55.368498 31.573473,55.368498 37.963881,55.368498 43.934222,52.769411 48.404467,48.272001 52.874716,43.675039 55.304919,37.678492 55.234969,31.281786 55.234969,30.782074 55.204939,30.282362 55.164896,29.78265L62.375304,27.084986C62.555369,28.384041 62.655348,29.683098 62.665358,30.982155 62.755331,39.37771 59.575201,47.272577 53.714854,53.269121 47.85451,59.166117 40.013937,62.56455 31.653435,62.664103 31.543442,62.664103 31.433451,62.664103 31.323458,62.664103 23.022896,62.664103 15.202467,59.366198 9.2920688,53.569731 3.3816691,47.772287 0.081538729,39.976973 0.0014552658,31.582396 -0.11854687,19.08959 7.1919631,7.7953143 18.622601,2.6986404L18.842707,2.5990892 18.942688,2.4985604C22.702931,0.89987225,26.703177,0.10052795,30.843447,2.5298505E-07z"
                              Fill="#FF000000"
                              RenderTransformOrigin="0.5,0.5"
                              Stretch="Uniform" />
                    </Grid>
                </SlideTab:SlideTabItem.Header>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <ContentControl x:Name="ServiceTimeline"
                                    HorizontalContentAlignment="Stretch"
                                    VerticalContentAlignment="Stretch" />
                </Grid>
            </SlideTab:SlideTabItem>
            <SlideTab:SlideTabItem x:Name="stiObjects"
                                   Height="50"
                                   MinWidth="75"
                                   Background="{x:Null}"
                                   FontSize="16"
                                   Foreground="Black"
                                   Padding="0"
                                   ShowHeaderText="Hidden"
                                   Style="{DynamicResource TabItemStyle1}">
                <SlideTab:SlideTabItem.Header>
                    <Grid Margin="0"
                          Background="Transparent"
                          RenderTransformOrigin="0.5,0.5">
                        <Path Width="30"
                              Height="30"
                              Margin="0,0,0,0"
                              Data="F1M54.8672,51.2266L42.1145,36.0703C44.2473,33.3333 45.6692,29.9946 46.0469,26.2942 47.1016,15.8333 39.4948,6.49219 29.0313,5.43213 18.5729,4.37231 9.2395,11.9868 8.17188,22.4453 7.10938,32.9036 14.7291,42.2446 25.1875,43.3098 28.6692,43.6563 32.0416,43.0469 35.0051,41.6797L47.9244,57.0547C49.5416,58.9634 52.401,59.2134 54.3125,57.6094 56.2266,55.9973 56.4766,53.1348 54.8672,51.2266 M15.9219,23.1614C16.5547,16.9399 22.1094,12.4087 28.3333,13.0391 34.5573,13.6719 39.0781,19.2266 38.4453,25.4426 37.8098,31.6692 32.2708,36.1953 26.0416,35.5703 19.8203,34.9399 15.2891,29.3828 15.9219,23.1614"
                              Fill="#FF000000"
                              RenderTransformOrigin="0.5,0.5"
                              Stretch="Uniform">
                            <Path.RenderTransform>
                                <TransformGroup>
                                    <RotateTransform Angle="0" />
                                    <ScaleTransform ScaleX="1" ScaleY="1" />
                                </TransformGroup>
                            </Path.RenderTransform>
                        </Path>
                    </Grid>
                </SlideTab:SlideTabItem.Header>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <StackPanel VerticalAlignment="Top">
                        <!--<Custom:SurfaceCheckBox x:Name="ShowTimeline" Content="Show Timeline" HorizontalAlignment="Left" Margin="0" Style="{DynamicResource SurfaceCheckBoxStyle1}" Visibility="Visible" VerticalAlignment="Top" Foreground="Black" IsChecked="{Binding Service.Settings.ShowTimeline, Mode=TwoWay}" />-->
                        <controls:KeyboardTextBox x:Name="FilterText"
                                                  Margin="8"
                                                  FontSize="33.333"
                                                  Watermark="Search" />
                        <StackPanel Orientation="Horizontal">
                            <Custom:SurfaceCheckBox x:Name="FilterLocation"
                                                    Margin="0"
                                                    HorizontalAlignment="Left"
                                                    VerticalContentAlignment="Top"
                                                    Background="Transparent"
                                                    Content="Extent filter"
                                                    FontSize="24"
                                                    Foreground="Black"
                                                    IsChecked="{Binding Service.Settings.FilterLocation,
                                                                        Mode=TwoWay}"
                                                    Style="{DynamicResource SurfaceCheckBoxStyle1}" />
                            <!--<Custom:SurfaceCheckBox x:Name="FilterMap"
                                                    Margin="0"
                                                    HorizontalAlignment="Left"
                                                    VerticalAlignment="Top"
                                                    Background="Transparent"
                                                    Content="Map Filter"
                                                    FontSize="24"
                                                    Foreground="Black"
                                                    IsChecked="{Binding Service.Settings.FilterMap,
                                                                        Mode=TwoWay}"
                                                    Style="{DynamicResource SurfaceCheckBoxStyle1}"
                                                    Visibility="Visible"
                                                    cal:Message.Attach="[Event Checked]=[Action UpdateFilterMap()];[Event Unchecked]=[Action UpdateFilterMap()]" />-->
                        </StackPanel>
                        <TextBlock Foreground="Black"
                                   Text="Too many items, refine your search"
                                   Visibility="{Binding Service.SearchToLong,
                                                        Converter={StaticResource BooleanToVisibilityConverter}}" />
                    </StackPanel>
                    <Custom:SurfaceListBox x:Name="Pois"
                                           Grid.Row="1"
                                           MaxWidth="310"
                                           Margin="0"
                                           HorizontalContentAlignment="Stretch"
                                           Background="{x:Null}"
                                           BorderBrush="{x:Null}"
                                           ItemTemplate="{DynamicResource DataTemplate1}"
                                           ItemsSource="{Binding Service.SearchContent}"
                                           ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                           ScrollViewer.VerticalScrollBarVisibility="Hidden">
                        <Custom:SurfaceListBox.Resources>
                            <DataTemplate x:Key="DataTemplate1" DataType="dataServer:PoI">
                                <Grid Width="Auto"
                                      Height="Auto"
                                      Background="{x:Null}"
                                      Opacity="{Binding IsVisible,
                                                        Converter={StaticResource BooleanActiveOpacityConverter}}">
                                    <Grid>
                                        <csDataServerPlugin:ucPoiPreview Width="24"
                                                                         Height="24"
                                                                         Margin="2,0,0,0"
                                                                         HorizontalAlignment="Left"
                                                                         VerticalAlignment="Top"
                                                                         PoI="{Binding}" />
                                        <StackPanel Grid.Row="0"
                                                    Margin="0"
                                                    Orientation="Vertical">
                                            <Grid x:Name="grid" Margin="30,0,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel MaxWidth="{Binding ActualWidth, ElementName=grid}" Margin="0,0,0,0">
                                                    <TextBlock Text="{Binding Name}" />
                                                    <TextBlock FontSize="12" Text="{Binding SubTitlesText}" />
                                                </StackPanel>

                                                <StackPanel Grid.Column="1"
                                                            Margin="2,0,0,0"
                                                            HorizontalAlignment="Right"
                                                            Orientation="Horizontal"
                                                            RenderTransformOrigin="0.5,0.5">
                                                    <StackPanel.LayoutTransform>
                                                        <TransformGroup>
                                                            <ScaleTransform />
                                                            <SkewTransform />
                                                            <RotateTransform />
                                                            <TranslateTransform X="20" />
                                                        </TransformGroup>
                                                    </StackPanel.LayoutTransform>

                                                    <Custom:SurfaceButton x:Name="ZoomButton1"
                                                                          MinWidth="20"
                                                                          MinHeight="20"
                                                                          Margin="0"
                                                                          VerticalAlignment="Center"
                                                                          Background="Transparent"
                                                                          cal:Message.Attach="[Event Click]=[Action Zoom($dataContext)]">
                                                        <Path Width="17"
                                                              Height="17"
                                                              Margin="0,0,0,0"
                                                              Data="F1M1937.77,2316.51L1924.92,2300.18C1929.1,2294.35 1929.14,2286.25 1924.48,2280.33 1918.84,2273.15 1908.45,2271.92 1901.27,2277.56 1894.1,2283.2 1892.86,2293.59 1898.5,2300.77 1903.23,2306.77 1911.26,2308.6 1917.96,2305.74L1930.77,2322.02 1937.77,2316.51z M1903.81,2296.59C1900.48,2292.35 1901.21,2286.21 1905.45,2282.87 1909.69,2279.53 1915.84,2280.26 1919.17,2284.51 1922.51,2288.75 1921.78,2294.89 1917.54,2298.23 1913.29,2301.57 1907.15,2300.84 1903.81,2296.59z"
                                                              Fill="#FF898989"
                                                              RenderTransformOrigin="0.5,0.5"
                                                              Stretch="Uniform">
                                                            <Path.RenderTransform>
                                                                <TransformGroup>
                                                                    <RotateTransform Angle="0" />
                                                                    <ScaleTransform ScaleX="1" ScaleY="1" />
                                                                </TransformGroup>
                                                            </Path.RenderTransform>
                                                        </Path>
                                                    </Custom:SurfaceButton>
                                                    <Custom:SurfaceButton x:Name="EditButton"
                                                                          MinWidth="20"
                                                                          MinHeight="20"
                                                                          Margin="0"
                                                                          VerticalAlignment="Center"
                                                                          Background="Transparent"
                                                                          cal:Message.Attach="[Event Click]=[Action Edit($dataContext)]">
                                                        <Path Width="17"
                                                              Height="17"
                                                              Margin="0,0,0,0"
                                                              Data="M0,44.439791L18.98951,54.569246 0.47998798,62.66881z M17.428029,12.359973L36.955557,23.568769 21.957478,49.686174 20.847757,46.346189 15.11851,45.756407 14.138656,42.166935 8.5292659,41.966761 6.9493899,38.037481 2.4399572,38.477377z M26.812517,0.0009765625C27.350616,-0.012230873,27.875986,0.10826397,28.348372,0.3782568L42.175028,8.3180408C43.85462,9.2780154,44.234529,11.777948,43.02482,13.89789L41.375219,16.767812 21.460039,5.3381228 23.10964,2.4582005C23.979116,0.941679,25.437378,0.034730911,26.812517,0.0009765625z"
                                                              Fill="#FF898989"
                                                              RenderTransformOrigin="0.5,0.5"
                                                              Stretch="Uniform">
                                                            <Path.RenderTransform>
                                                                <TransformGroup>
                                                                    <RotateTransform Angle="0" />
                                                                    <ScaleTransform ScaleX="1" ScaleY="1" />
                                                                </TransformGroup>
                                                            </Path.RenderTransform>
                                                        </Path>
                                                    </Custom:SurfaceButton>

                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>
                                    </Grid>
                                </Grid>
                            </DataTemplate>
                        </Custom:SurfaceListBox.Resources>
                        <!--<Custom:SurfaceListBox.ItemContainerStyle>
                            <Style TargetType="{x:Type Custom:SurfaceListBoxItem}">

                            </Style>
                        </Custom:SurfaceListBox.ItemContainerStyle>-->
                    </Custom:SurfaceListBox>
                </Grid>
            </SlideTab:SlideTabItem>
            <SlideTab:SlideTabItem x:Name="stiFilter"
                                   Height="50"
                                   MinWidth="75"
                                   FontSize="16"
                                   Foreground="Black"
                                   IsSelected="True"
                                   Padding="0"
                                   ShowHeaderText="Hidden"
                                   Style="{DynamicResource TabItemStyle1}"
                                   Visibility="{Binding ShowFilter,
                                                        Converter={StaticResource BooleanToVisibilityConverter}}">
                <SlideTab:SlideTabItem.Header>
                    <Grid Margin="0">
                        <Path Width="30"
                              Height="30"
                              Margin="0,0,0,0"
                              Data="M2.1299944,9.9798575L55.945994,9.9798575 35.197562,34.081179 35.197562,62.672859 23.428433,55.942383 23.428433,33.52121z M1.3001332,0L56.635813,0C57.355887,0,57.935946,0.5891428,57.935946,1.3080959L57.935946,2.8258877C57.935946,3.5448422,57.355887,4.133985,56.635813,4.133985L1.3001332,4.133985C0.58005941,4.133985,-2.3841858E-07,3.5448422,0,2.8258877L0,1.3080959C-2.3841858E-07,0.5891428,0.58005941,0,1.3001332,0z"
                              Fill="#FF141414"
                              RenderTransformOrigin="0.5,0.5"
                              Stretch="Uniform">
                            <Path.RenderTransform>
                                <TransformGroup>
                                    <RotateTransform Angle="0" />
                                    <ScaleTransform ScaleX="1" ScaleY="1" />
                                </TransformGroup>
                            </Path.RenderTransform>
                        </Path>
                    </Grid>
                </SlideTab:SlideTabItem.Header>
                <Grid Width="{Binding ActualWidth,
                                      ElementName=userControl}"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch">

                    <ContentControl x:Name="AnalysisTab"
                                    HorizontalContentAlignment="Stretch"
                                    VerticalContentAlignment="Stretch" />
                </Grid>
            </SlideTab:SlideTabItem>
            <SlideTab:SlideTabItem x:Name="stiBackup"
                                   Height="50"
                                   MinWidth="75"
                                   FontSize="16"
                                   Foreground="Black"
                                   IsSelected="false"
                                   Padding="0"
                                   ShowHeaderText="Hidden"
                                   Style="{DynamicResource TabItemStyle1}"
                                   Visibility="{Binding ShowFilter,
                                                        Converter={StaticResource BooleanToVisibilityConverter}}">
                <SlideTab:SlideTabItem.Header>
                    <Grid Margin="0">
                        <Path Width="30"
                              Height="30"
                              Margin="0,0,0,0"
                              Data="M43.705524,22.886999L43.703026,26.81893 39.772003,26.820429 39.772003,29.158669 43.704224,29.160168 43.704224,33.090599 46.045479,33.091999 46.045479,29.158669 49.979,29.158669 49.977501,26.817829 46.045479,26.81893 46.045479,22.886999z M44.675049,19.103001C49.544869,19.103001 53.490002,23.049544 53.490002,27.919049 53.490002,32.787457 49.544869,36.734001 44.675049,36.734001 39.807934,36.734001 35.860001,32.787457 35.860001,27.919049 35.860001,23.049544 39.807934,19.103001 44.675049,19.103001z M12.668,18.997L12.668,25.529002 15.704229,25.529002 15.704229,22.045534 26.948771,22.045534 26.948771,25.529002 30.000999,25.529002 30.000999,18.997z M3.1149076,7.4190009L3.1149076,10.885287 39.552383,10.885287 39.552383,7.4190009 40.833683,8.7080815C42.117378,9.9960626 43.036778,10.342279 42.521076,13.062524 42.448586,13.443751 42.337154,14.065398 42.198143,14.857906L42.18602,14.927161 42.012375,14.958257C35.989857,16.193947 31.446001,21.53567 31.446001,27.918999 31.446001,30.426358 32.147286,32.773098 33.364002,34.773365L33.400974,34.830979 6.1643343,34.830979C6.1643339,34.830979 3.9223967,34.85978 3.5159078,32.654045 3.1461576,30.642014 0.65922062,15.773469 0.14615673,13.062524 -0.36946805,10.342279 0.5471568,9.9960626 1.8310892,8.7080815z M6.1649995,4.3539994L36.500999,4.3539994 36.500999,8.7079995 6.1649995,8.7079995z M10.498,0L32.167999,0 32.167999,2.1769994 10.498,2.1769994z"
                              Fill="#FF141414"
                              RenderTransformOrigin="0.5,0.5"
                              Stretch="Uniform">
                            <Path.RenderTransform>
                                <TransformGroup>
                                    <RotateTransform Angle="0" />
                                    <ScaleTransform ScaleX="1" ScaleY="1" />
                                </TransformGroup>
                            </Path.RenderTransform>
                        </Path>
                    </Grid>
                </SlideTab:SlideTabItem.Header>
                <Grid Width="{Binding ActualWidth,
                                      ElementName=userControl}"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch">

                    <ContentControl x:Name="BackupTab"
                                    HorizontalContentAlignment="Stretch"
                                    VerticalContentAlignment="Stretch" />
                </Grid>
            </SlideTab:SlideTabItem>

        </SlideTab:SlideTabControl>

        <Custom:SurfaceToggleButton Margin="0"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    HorizontalContentAlignment="Right"
                                    IsChecked="{Binding Service.IsVisible}"
                                    Visibility="Collapsed">
            <Path Width="30"
                  Height="30"
                  Margin="0,0,0,0"
                  Data="M33.597977,10.759002C37.946865,10.759002 41.485962,14.285001 41.485962,18.649 41.485962,23 37.946865,26.535 33.597977,26.535 29.23909,26.535 25.709992,23 25.709992,18.649 25.709992,17.784 25.849955,16.953001 26.109888,16.174002 26.779719,16.881001 27.70948,17.327002 28.759213,17.327002 30.778696,17.327002 32.418278,15.691001 32.418278,13.668001 32.418278,12.663001 32.008381,11.748001 31.348551,11.087002 32.058369,10.876001 32.818176,10.759002 33.597977,10.759002z M33.606682,4.3679962C25.92741,4.3679957 19.698065,10.594956 19.698065,18.27293 19.698065,25.953894 25.92741,32.177862 33.606682,32.177862 41.295838,32.177862 47.515175,25.953894 47.515175,18.27293 47.515175,10.594956 41.295838,4.3679957 33.606682,4.3679962z M34.867642,1.546141E-09C36.890393,2.6508449E-05 58.705193,0.41938579 68.893006,18.299923 68.893006,18.299923 57.1442,36.139837 34.44656,34.768854 34.44656,34.768854 14.428583,36.59984 0,18.299923 0,18.299923 9.0791523,0.4590019 34.716553,0.0010111886 34.716553,0.0010114873 34.768162,-1.4442128E-06 34.867642,1.546141E-09z"
                  Fill="#FF000000"
                  RenderTransformOrigin="0.5,0.5"
                  Stretch="Uniform" />
        </Custom:SurfaceToggleButton>
    </Grid>
</UserControl>